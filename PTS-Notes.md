# eJPT Notes

## Section 1: Assessment Methologies

### Passive Information Gathering

- Linux Commands
  - `host` - linux command used for checking IP address of website
  - `whatweb` - linux commnad (preinstalled on kali) used for duscovering web technologies that are used in a website
  - `dnsrecon` - linux command (preinstalled on kali) used for revealing dns information (in the form of dns records) of websites
- Web Files
  - `robots.txt` - web file that prevents web crawlers from indexing specific directories mentioned in the `disallow:` section
  - `sitemap.xml` - web file that provides engines an organised way to structure the website, provides webpages that can be publicly accessed on search engines
- Web Extensions
  - **Built With** - web extension that shows the website's details
  - **WAPPALYZER** - another web extension that shows what web technologies are used in a website
- Information Gathering Tools
  - **WebHTTRack** - tool that allows you to copy a website online into a local directory
  - **WHOIS** - query and response protocol that shows domain name availability or to discover domain information
  - **NetCraft** - website that provides a ton of information on websites
  - **DNS Dumpster** - similiar to `dnsrecon` but more organised
  - **WAFW00F** - web application firewall fingerprinting tool `wafw00f`
  - **Sublist3r** - tool that performs enumerates subdomains of websites using OSINT `sublist3r`
  - **Wayback Machine** - tool that shows how websites looked like in the past
  - **Google Hacking Database** - exploit-db page that shows interesting google dorks that reveal information
  - **The Harvester** - tool that gathers email addresses, names, addresses, IPs and URLs using multiple public data sources `theharvester`
- Google Dorks
  - `site:` - limit all results specific to that site
    - `site: *.site.com` - limit all results specific to the site's subdomains, where * means anything (wildcard character)
  - `inurl:` - limit all results that contain that in the url
  - `intitle` - limit all results that contain that in the title
  - `filetype:` - limit all results that are that specific filetype
  - `cache:` - loads the website information stored in your cache
- Leaked Password Databases
  - **haveibeenpwned.com** - website that allows users to check if their email or phone has been in a data breach - linked to theharvester where the information previous gathered (for example email addresses) can be used in this website to check if they have been in a data breach where their passwords have been leaked

### Active Informaiton Gathering

- DNS Zone Transfers
  - What is DNS?
    - Domain Name System is a protocol that is used to resolve domain names/hostnames into IP addresses. 
    - A DNS server is like a telephone directory that contains domain names and their corresponding IP addresses
    - A plethora of public DNS servers have been se up by companies Cloudflare and Google. These DNS servers contain the records of almost all domains on the internet.
  - DNS Records
    - A - Resolves a hostname or domain to an IPv4 address
    - AAAA - Resolves a hostname or domain to an IPv6 address
    - NS - Reference tp the domains nameserver
    - MX - Resolves a domain to a mail server
    - CNAME - Used for domain aliases
    - TXT - Text record
    - HINEO - Host Information
    - SOA - Domain authority
    - SRV - Service records
    - PTR - Resolves an IP address to a hostname
  - DNS Interrogation
    - DNS interrogation is the process of enumerating DNS records for a specific domain
    - The objective of DNS interrogation is to probe a DNS server to provide us with DNS records for a specific domain
    - This process can provide with important information like the IP address of a domain, subdomains, mail server addresses etc.
    - This process can provide with improtant information like the IP address of a domain, subdomains, mal server addresses
  - DNS Zone Transfer
    - Zone files contain DNS information
    - In certain cases DNS server admins may want to copy or transfer zone files from one DNS server to another. This is known as a zone transfer.
    - If misconfigured and left unsecured, this functionality can be abused by attackers to copy the zone file from the primary DNS server to another DNS server
    - A DNS Zone transfer can provide penetration testers with a hollistic view of an organisation's network layout
    - Furthermore, in certain cases, internal network addresses may be found on an organisation's DNS servers.
  - `dnsenum`
    - Tool that performs both passive and active DNS reconnaissance (and tries to automatically perform a DNS zone transfer)
  - `dig`
    - dns lookup utility
  - `fierce`
    - A semi-lightweight scanner that helps locate non-contiguous IP space and hostnames against specificed domains.
  - "Local DNS Server"
    - In linux systems, the `/etc/hosts` file locally maps domain names to IP addreses in the system itself.
  - Host Discovery with `nmap`
    - `sudo nmap -sn 192.168.20.0/24` - scans all IP addresses in the range (in this case, its `192.168.20.0/24`, 192.168.20.0-192.168.20.255, where 192.168.20.0 is the subnet mask)
  - Port Discovery with `nmap`
    - `nmap` - performs default nmap scan - SYN scan on thousand most frequently used ports
      - `nmap -Pn` - avoid checking if host is online
      - `nmap -p-` - check all 65,535 ports
      - `nmap -p 80,443` - select specific ports to scan (in this example, port 80 and 443)
      - `nmap -p 10-443` - select port range to scan (in this example, port 10 to 443)
      - `nmap -F` - perform fast scan
      - `nmap -sU` - perform **UDP** scan
      - `nmap -v` - increase verbosity of the scan, provide more details on the scan
      - `nmap -sC` - run a list of nmap scripts to enumerate more information from these open ports
      - `nmap -T5` - adjust timing template to 5 (controls how fast nmap scans from a range of 0 to 5 )
  - Service Discovery with `nmap`
    - `nmap -sV` - perform service version discovery (on the ports)

### Footprinting & Scanning

- Mapping a Network
  - Purpose
    - Turn it into a network properly mapped out
  - Process
    - Physical Access
      - Physical Security
      - OSINT
      - Social Engineering
    - Sniffing
      - Passive Reconnaissance
      - Watch network traffic
      - How? ARP will be utilised
        - ARP stands for Address Resolution Protocol and maps IP addresses to MAC addresses
        - Who has 10.10.1.5? Tell 10.10.1.7
        - 10.10.1.5 is at 00:0c:29:af:ea:d2
        - Result will be added to ARP table 
      - ICMP - Internet Control Message Protocol
        - Tools: `traceroute`, `ping`
    - Tools
      - Wireshark
      - ARP-Scan - Uses ARP to scan which hosts are online on the network
        - `sudo arp-scan -I eth0 -g 10.10.1.0/24`
      - Ping - Sends an ICMP packet to the IP address mentioned to check if its online
      - FPing - Send out pings to multiple hosts at one time
        - `fping -I tap0 -g 10.142.111.0/24 -a 2>/dev/null`
        - `2>/dev/null` sends error messages (STDERR) to `/dev/null`
      - nmap
      - zenmap - GUI version of nmap

- Port Scanning
  - Purpose
    - Identify Operating System
      - Revealed by Signatures
      - Revealed by services - detected by banner detected in TCP connection
    - Identify Services
  - Process
    - Mentioned in active information gathering
  - Tools
    - nmap
    - zenmap
    - massscan
    - rustscan
    - autorecon

### Enumeration

- SMB
  - SMB stands for Server Message Block
  - Windows implementation of a file share
  - Common ports related to SMB: 135,139,**445**
  - Connect to filesystems of other hosts in the network via SMB by mounting their filesystems onto ours
  - `\\10.10.1.2\C$` - example smb file share address(?)
  - **NMAP Scripts** - nmap scripts to use in nmap for further enumeration of SMB in that network
    - `nmap -p 445 --script smb-protocols 10.4.31.90` - example
    - `smb-protocols` - shows what protocols and dialect it is using
    - `smb-security-mode` - exposes security level of the smb protocol in that system
    - `smb-enum-sessions` - enumerate smb sessions (who has logged in etc)
    - `smb-enum-shares` - enumerate smb shares
    - `smb-enum-users` - view users available on smb system
    - `smb-enum-users` - enumerate smb user groups
    - `smb-enum-services` - enumerate what services are running
    - `smb-ls` - tell us whats actually in these shares
    - `--script-args smb_username=administrator,smbpassword=smbserver_771` - script arguments to log in as that user stated
  - **SMBMap** - enumerates and accesses smb shares on the network
    - `smbmap -u guest -p "" -d . -H 10.426.50` - example command
    - `-x 'ipconfig` - `-x` flag to run a command
    - `-L`
    - `-r 'C$` - connect to C drive and view contents of it
    - `-upload 'local_file' 'C$\local_file'` - uploads local file to C network drive via SMB
    - `--download 'C$\flag.txt` - download flag.txt from C network drive via SMB
  - SMB: Samba
    - Linux version of SMB
      - `msfconsole` - Metasploit console
      - `use` - command to use exploit/auxiliary/post-exploit module
      - `auxiliary/scanner/smb/smb_version` - module to view smb version on the host
      - `options` - view options
      - `set` - set options
      - `nmblookup` - ultilise NETBIOS connection to enumerate the status of the IP address
      - `smbclient` - connect to client via smb(?) - `smbclient -L ip_address` - list out the SMB shares on the IP address - `smbclient //ip_address/Public -N` - connect to the public share on the IP address
      - `rpcclient` - connect to client via RPC - `rpcclient -U "" 192.76.242.3` (null session)
        - `srvinfo` - view serivce information when connected via RPC
      - `enum4linux` - powerful smb enumerator
  - Samba Dictionary Attack
    - We will attempt to bruteforce into an SMB session by using metasploit
    - `msfconsole` -> `use auxiliary/scanner/smb/smb_login` -> `set RHOSTS ip_address` -> `set smbuser jane, set passfile word_list, set smbuser username`
    - We can also use Hydra and the rockyou wordlist
    `hydra -l username -P wordlist ip_address smb`
    - From the information gathered (that enables us to access the session)
      - Check if there are any other connections/pipes to this authenticated SMB session -> `auxiliary/scanner/smb/pipe_auditor` -> provides a list of pipes (`\netlogon`, `\lsarpc`, `\eventlog`)
      - `enum4linux -r -u "username" -p "password" ip_address`
- FTP
  - FTP stands for File Transfer Protocol
  - Storing files on a server and being able to access them remotely
  - Default port: **21**
  - Connect to the FTP port on the ip address -> `ftp ip_address`
  - Bruteforce FTP session by bruteforcing username and password - `hydra -L user_wordlist(/usr/share/metasploit-framework/data/wordlists/common_users.txt) -P /usr/share/metasploit-framework/data/wordlists/unix_password.txt ip_address ftp`
  - `get file` - download file to local machine when connected via FTP
  - `nmap ip_address -p 21 --script ftp-anon` -> check if ftp anonymous login is allowed
- SSH
  - SSH stands for Secure Shell
  - Used for remote administration
  - Interact with a remote machine over an encrypted channel
  - Default port: **22**
  - `ssh username@ip_address` - connect to machine via ssh
  - `--script ssh-enum-algos` - nmap script to enumerates the algorithm that could have been use to generate the key for the ssh session
  - `--script ssh-hostkey --script-arg ssh_hostkey=full` - reveal full rsa host key for the ssh session
  - `--script ssh-auth-methods --script-args="ssh.user=student"` - view authentication methods for user `student`
  - `hydra -l student - P /usr/share/wordlists/rockyou.txt ip_address ssh` - bruteforce into ssh session as user `student`
  - `msfconsole`'s `auxiliary/scanner/ssh/ssh_login` can be used for bruteforce attack as well
- HTTP
  - Stands for HyperText Transfer Protocol
  - One of the most common protocols
  - Use to connect to the internet
  - Common ports: **80**, 443 (HTTPS), 8080 (less common)
  - Internet Information Services (IIS)
    - Flexible, secure and manageable Web server framework
    - Common file extensions found on this server: `.aspx`
  - `whataweb` - find information about the web server at that IP Address
  - `http` - sends http request to web server and displays http response
  - `dirb` OR `dirbuster` - automatically does directory brute-forcing to find the directories of the web server
  - `browsh --startup-url http://ip_address` - do website enumeration based on a url in your command line by rendering the page in the command line
  - `nmap` HTTP enumeration scripts
    - `--script http-enum` - return what HTTP service is running and reveals some common directories that the web server may have
    - `--script http-headers` - returns HTTP header information (based off the HTTP response?)
    - `--script http-methods --script-args http-methods.url-path=/directory/` - reveals what http methods are supported
  - Apache
    - Type of web server that runs on Linux
- SQL
  - MySQL
    - One of the most common open version of SQL
    - Runs on Ubuntu
    - Common on enterprise network
    - Common ports: **3306**
    - `mysql -h ip_address -u username` - log in to the mysql database of the host
      - `show databases` - show databases of the host
      - `select count(*) from authors` - select count of entries in the `author` database
      - `select * from authors`
      - `select load_file("/directory/file")` - loads local file on the system
    - `msf5 -> auxiliary/scanner/mysql/mysql_writable_dirs` - run a brute froce of all the directories and see if they're writable
    - `msf5 -> use auxiliary/scanner/mysql/mysql_hashdump` - dumps the hashes of the user accounts
    - `msf5 -> auxiliary/scanner/mysql/mysql_login` - attempts to log in to the accounts
    - `setg` - set global variable
    - `nmap --script=mysql-empty-password` - check what sql accounts require no passwords
    - `nmap --script=mysql-users --script=args="mysqlusers='root',mysqlpass=''"` - view all the users of the sql database
    - `nmap --script=mysql-databases --script=args="mysqlusers='root',mysqlpass=''"` - view all the databases of the sql system
    - `nmap --script=mysql-variables --script=args="mysqlusers='root',mysqlpass=''"` - view the mysql variables on the system
    - `nmap --script=mysql-dump-hashes --script=args="mysqlusers='root',mysqlpass=''"` - same as the msf5 module mentioned above; dumps hashes of the mysql user
    - `nmap --script=mysql-audit --script=args="mysql-audit.username='root',mysql-audit.password='',mysql-audit.filename='/usr/share/nmap/nselib/data/mysql-cis.audit"` - audits the mysql database on the system - check if stuff has been configured properly
    - `hydra -l username -P wordlist ip_address mysql` - same as the msf5 module; brute forces passwords to attempt to log into the mysql database account
  - MSSQL - Microsoft version of SQL
    - Common Ports: **1433**
    - `nmap --script ms-sql-info` - reveals mssql information about the host
    - `nmap --script ms-sql-ntlm-info --script-args mssql.instance.port=1433` - reveals mssql NTLM information about the host
    - `nmap --script ms-sql-info --script-args userdb=/root/Desktop/wordlist/common_users.txt,passdb=/root/Desktop/wordlist/100-common-passwords.txt` - atttempts to brute force login into the mssql accounts in the host
    - `nmap --script ms-sql-empty-password` - attempt to check if empty password logins are allowed
    - `nmap --script ms-sql-query` - sends a query into the mssql system
    - `nmap --script ms-sql-dump-hashes` - dump account hashes of the system
    - `nmap --script ms-sql-xp-cmdshell` - attempts to run commands on the mssql system
    - Metasploit modules
      - `auxiliary/scanner/mssql/mssql_login` - brute-force login into mssql accounts in the host
      - `auxiliary/admin/mmssql/mssql_enum` - enumerates the mssql system
      - `auxiliary/admin/mssql/mssql_exec` - tries to run commands on the mssql server
      - `auxiliary/scanner/mssql_enum_domain_accounts` - shows all the domain accounts in the mssql server
